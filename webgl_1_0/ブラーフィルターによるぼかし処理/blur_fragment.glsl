
precision mediump float;

uniform sampler2D texture;
uniform bool useBlur;

varying vec4 vColor;

void main(void) {
    vec2 tFrag = vec2(1.0 / 512.0);
    vec4 destColor = texture2D(texture, gl_FragCoord.st * tFrag);

    if (!useBlur) {
        gl_FragColor = vColor * destColor;
        return;
    }

    destColor *= 0.36;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(-1.0, 1.0)) * tFrag) * 0.04;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(0.0, 1.0)) * tFrag) * 0.04;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(1.0, 1.0)) * tFrag) * 0.04;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(-1.0, 0.0)) * tFrag) * 0.04;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(1.0, 0.0)) * tFrag) * 0.04;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(-1.0, -1.0)) * tFrag) * 0.04;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(0.0, -1.0)) * tFrag) * 0.04;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(1.0, -1.0)) * tFrag) * 0.04;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(-2.0,  2.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(-1.0,  2.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2( 0.0,  2.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2( 1.0,  2.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2( 2.0,  2.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(-2.0,  1.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2( 2.0,  1.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(-2.0,  0.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2( 2.0,  0.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(-2.0, -1.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2( 2.0, -1.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(-2.0, -2.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2(-1.0, -2.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2( 0.0, -2.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2( 1.0, -2.0)) * tFrag) * 0.02;
    destColor += texture2D(texture, (gl_FragCoord.st + vec2( 2.0, -2.0)) * tFrag) * 0.02;
    gl_FragColor = vColor * destColor;
}